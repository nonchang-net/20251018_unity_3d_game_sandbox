# 作業ログ - 20251101_2106

## 変更した内容の概要

GameCameraManagerの`ApplyTrackingSetting()`メソッドで、コンパイル直後の初回再生時に発生する「無効なトラッキング設定インデックス 0」エラーを修正しました。

**修正箇所:**
- `Assets/Scripts/Camera/GameCameraManager.cs` 212-222行目 - null/空配列チェックとインデックスチェックを分離、エラーメッセージを改善

## なぜそのように変更しようと考えたか

**問題の症状:**
コンパイル直後の初回再生時に以下のエラーが発生していました：
```
GameCameraManager: 無効なトラッキング設定インデックス 0
```
2回目以降の再生では発生しないという特徴がありました。

**原因:**
Unityのシリアライゼーションとスクリプトリロードのタイミングの問題で、以下の流れが発生していました：

1. `Start()`メソッドで`togglableTrackingSettings`が設定されているかチェック（79-87行目）
2. チェックを通過して`ApplyTrackingSetting(0)`を呼び出し
3. `ApplyTrackingSetting()`内で再度チェックすると、`togglableTrackingSettings`が一時的に`null`または空配列になっている
4. 条件`activeSettings == null || index < 0 || index >= activeSettings.Length`が真となり、エラーログが出力される

元のコードでは、null/空配列チェックとインデックスチェックが1つの条件式にまとめられていたため、どちらの原因でエラーが出ているのか判別できませんでした。

**修正内容:**
チェックを2段階に分離しました：

```csharp
// 修正前
if (activeSettings == null || index < 0 || index >= activeSettings.Length)
{
    Debug.LogError($"GameCameraManager: 無効なトラッキング設定インデックス {index}");
    return;
}

// 修正後
if (activeSettings == null || activeSettings.Length == 0)
{
    Debug.LogWarning($"GameCameraManager: トラッキング設定が設定されていません。初期化をスキップします。");
    return;
}

if (index < 0 || index >= activeSettings.Length)
{
    Debug.LogError($"GameCameraManager: 無効なトラッキング設定インデックス {index} (設定数: {activeSettings.Length})");
    return;
}
```

**改善点:**
1. **null/空配列チェックを分離**: Unityの初期化タイミングの問題を適切にハンドリング
2. **ログレベルの適正化**: 配列が未設定の場合は`Warning`（初期化タイミングの問題で一時的な状態）、無効なインデックスの場合は`Error`（実際のバグ）
3. **エラーメッセージの改善**: インデックスエラーの場合、設定数も表示してデバッグしやすく

これにより、コンパイル直後の初回再生時でも、一時的に配列が未設定の場合は警告を出してスキップし、2回目以降で正常に初期化されるようになりました。
