# 作業ログ - 20251102_1813

## 変更内容の概要

- Naughty Attributesパッケージを導入し、主要なスクリプトに適用しました。
- TrackingSetting.csでShowIf/HideIfを活用し、UIの使いやすさを向上させました。
- 必須の参照設定にRequiredアトリビュートを追加し、設定ミスを防止しました。

## 変更理由

- Naughty AttributesとUnity Debug Sheetsを導入したため、これらを活用してエディタの使いやすさを向上させる必要がありました。
- TrackingSettingで、Lock Camera Rotation有効時に障害物回避設定が不要であることを明確にする必要がありました。
- 必須の参照設定が未設定の場合、実行時エラーが発生するため、エディタ上で警告を出して設定ミスを防ぐ必要がありました。

## 実装詳細

### 1. TrackingSetting.cs への Naughty Attributes 適用

#### ShowIf/HideIf による条件付き表示

**障害物回避セクション（33-56行）**
```csharp
[Header("障害物回避")]
[InfoBox("カメラロック設定時は障害物回避機能は設定できません", EInfoBoxType.Warning)]
[ShowIf("lockCameraRotation")]
[SerializeField] private bool _dummyCollisionInfo = false; // InfoBox表示用のダミーフィールド

[HideIf("lockCameraRotation")]
[Tooltip("障害物回避を有効にするか")]
[SerializeField] private bool enableCollisionAvoidance = true;
// ... 他の障害物回避設定も同様にHideIfを適用
```

**効果:**
- `lockCameraRotation`が`true`の時：警告メッセージが表示され、障害物回避設定が非表示
- `lockCameraRotation`が`false`の時：通常通り障害物回避設定が表示

**カメラロック関連設定（81-94行）**
```csharp
[ShowIf("lockCameraRotation")]
[Tooltip("カメラ固定時の角度（Euler Angles）")]
[SerializeField] private Vector3 lockedCameraRotation = new Vector3(0f, 0f, 0f);

[ShowIf("lockCameraRotation")]
[Tooltip("カメラ固定時に上下方向の入力を無効化する（2Dゲーム風の操作）")]
[SerializeField] private bool disableVerticalInput = false;

[ShowIf("lockCameraRotation")]
[Tooltip("カメラロック解除時に、奥行き方向（yaw角度）を維持する")]
[SerializeField] private bool maintainYawOnUnlock = true;
```

**効果:**
- `lockCameraRotation`が`true`の時のみ関連設定を表示
- 不要な設定が非表示になることでUIが整理され、設定ミスを防止

### 2. 必須参照への Required アトリビュート適用

#### GameCameraManager.cs
```csharp
using NaughtyAttributes;

[Required("GameManagerの参照が必要です")]
[SerializeField] private GameManager gameManager;

[Required("メインカメラの参照が必要です")]
[SerializeField] private Camera currentCamera;

[Required("少なくとも1つのトラッキング設定が必要です")]
[SerializeField] private TrackingSetting[] togglableTrackingSettings;
```

#### CharacterTracker.cs
```csharp
using NaughtyAttributes;

[Required("追跡対象のTransformが必要です")]
[SerializeField] private Transform targetTransform;

[Required("トラッキング設定のScriptableObjectが必要です")]
[SerializeField] private TrackingSetting trackingSetting;
```

#### GameCharacterManager.cs
```csharp
using NaughtyAttributes;

[Required("GameManagerの参照が必要です")]
[SerializeField] private GameManager gameManager;

[Required("制御対象のキャラクターが必要です")]
[SerializeField] private GameObject targetCharacter;
```

#### PlayableCharacterRepository.cs
```csharp
using NaughtyAttributes;

[Required("GameManagerの参照が必要です")]
[SerializeField] private GameManager gameManager;
```

#### GameManager.cs
（すでにRequiredが適用済みでした）

### 3. 効果

#### UI/UXの向上
- **条件付き表示**: 関連する設定のみが表示され、UIが整理される
- **警告メッセージ**: 設定できない項目について明確な説明が表示される
- **設定ミス防止**: 必須参照が未設定の場合、エディタ上で赤く警告表示される

#### 開発効率の向上
- **早期エラー検出**: 実行時ではなくエディタ上で設定ミスを発見できる
- **明確な設定要件**: どの参照が必須かが一目瞭然
- **ドキュメント化**: Requiredのメッセージが設定要件のドキュメントとして機能

## 技術的なポイント

### ShowIf/HideIfの使い方

```csharp
[ShowIf("boolFieldName")]  // boolFieldNameがtrueの時に表示
[HideIf("boolFieldName")]  // boolFieldNameがfalseの時に表示
```

Naughty Attributesは、インスペクター上で条件付きで表示/非表示を切り替えることができます。今回はこれを活用して、`lockCameraRotation`の状態に応じて関連設定の表示を制御しました。

### InfoBoxの使い方

```csharp
[InfoBox("メッセージ", EInfoBoxType.Warning)]
```

ユーザーに重要な情報を伝えるためのボックスを表示できます。今回は、カメラロック時に障害物回避が使用できないことを警告しています。

### ダミーフィールドのテクニック

```csharp
[InfoBox("...", EInfoBoxType.Warning)]
[ShowIf("lockCameraRotation")]
[SerializeField] private bool _dummyCollisionInfo = false;
```

InfoBoxを条件付きで表示するために、ダミーフィールドを使用しています。このフィールド自体は使用されませんが、ShowIfとInfoBoxを組み合わせることで、条件付きメッセージ表示を実現しています。

## 今後の展開

Naughty Attributesには他にも便利な機能があります：
- `Button`: エディタ上でメソッドを実行するボタンを表示
- `MinMaxSlider`: 最小値と最大値を設定する特殊なスライダー
- `ReadOnly`: 読み取り専用フィールドとして表示
- `ValidateInput`: カスタムバリデーション

今後、必要に応じてこれらの機能も活用していくことができます。
